"use strict";(()=>{var e={};e.id=204,e.ids=[204],e.modules={1572:e=>{e.exports=require("nodemailer")},2793:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>d});var a=t(7508),n=t(1572),o=t.n(n),i=t(3139),u=e([i]);async function d(e,r){if("POST"!==e.method)return r.setHeader("Allow",["POST"]),r.status(405).end(`Method ${e.method} Not Allowed`);let{email:t}=e.body;if(!t)return r.status(400).json({error:"Missing email"});if(!await a.z.user.findUnique({where:{email:t}}))return r.status(404).json({error:"User not found"});let s=await i.default.hash("dify12345",10);await a.z.user.update({where:{email:t},data:{password:s}});try{let e=o().createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT)||587,secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}});await e.sendMail({from:process.env.SMTP_FROM||process.env.SMTP_USER,to:t,subject:"密碼已重設 Password Reset",text:`您的密碼已重設為 dify12345，請盡快登入後修改密碼。
Your password has been reset to dify12345. Please login and change it as soon as possible.`})}catch(e){return r.status(500).json({error:"Password reset, but failed to send email",detail:String(e)})}return r.status(200).json({success:!0})}i=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},3139:e=>{e.exports=import("bcryptjs")},3480:(e,r,t)=>{e.exports=t(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5710:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>d,routeModule:()=>p});var a=t(3480),n=t(8667),o=t(6435),i=t(2793),u=e([i]);i=(u.then?(await u)():u)[0];let d=(0,o.M)(i,"default"),l=(0,o.M)(i,"config"),p=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/user/reset-password",pathname:"/api/user/reset-password",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},7508:(e,r,t)=>{t.d(r,{z:()=>a});let s=require("@prisma/client"),a=global.prisma||new s.PrismaClient({log:["query","info","warn","error"]})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=5710);module.exports=t})();