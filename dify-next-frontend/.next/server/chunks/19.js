exports.id=19,exports.ids=[19],exports.modules={1409:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{A:()=>i}),r(2015);var a=r(7843),n=r(8732),o=e([a]);a=(o.then?(await o)():o)[0];let i=()=>{let{t:e}=(0,a.useTranslation)();return(0,n.jsx)("footer",{className:"w-full bg-gradient-to-r from-blue-400 via-blue-300 to-cyan-200 text-blue-900 py-6 mt-12 border-t border-blue-200 shadow-inner",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between px-4",children:[(0,n.jsxs)("div",{className:"text-sm opacity-80",children:["\xa9 ",new Date().getFullYear()," TPV OBM測試助理. ",e("all_rights_reserved","All rights reserved.")]}),(0,n.jsxs)("div",{className:"flex space-x-4 mt-2 md:mt-0",children:[(0,n.jsx)("a",{href:"/",className:"hover:text-cyan-700 transition-colors",children:"Home"}),(0,n.jsx)("a",{href:"/usage",className:"hover:text-cyan-700 transition-colors",children:e("chat_to_agentic")}),(0,n.jsx)("a",{href:"/login",className:"hover:text-cyan-700 transition-colors",children:e("login")})]})]})})};s()}catch(e){s(e)}})},1916:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var s=r(2015),a=r(4233),n=r(4560),o=r(7995);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){var s,a,n;s=e,a=t,n=r[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let c={enableVoice:!1,enableHistory:!0,primaryColor:"#3B82F6",customLogo:"/images/TPV-icon.png",avatarSrc:"/images/assistant-avatar.png",apiKey:"app-PxzkiLjnjcU2w2ARj5qeflQq",apiBaseUrl:"http://localhost/v1"},u=()=>{let{0:e,1:t}=(0,s.useState)(c),{0:r,1:a}=(0,s.useState)(!1);return(0,s.useEffect)(()=>{try{let e=localStorage.getItem("chatSettings");if(e){let r=JSON.parse(e);t(l(l(l({},c),r),{},{apiKey:r.apiKey||c.apiKey,apiBaseUrl:r.apiBaseUrl||c.apiBaseUrl}))}else t(c);a(!0)}catch(e){console.error("Failed to load settings:",e),t(c),a(!0)}},[]),(0,s.useEffect)(()=>{r&&localStorage.setItem("chatSettings",JSON.stringify(e))},[e,r]),{settings:e,updateSettings:e=>{t(t=>l(l({},t),e))},loaded:r}};var d=r(8732);let g=({children:e,loginRedirect:t="/login",allowUnauthenticated:r=!1})=>{let{isAuthenticated:s}=(0,n.A)(),{settings:i,loaded:l}=u(),c=(0,a.useRouter)();return l?r||s?(0,d.jsx)(d.Fragment,{children:e}):(0,d.jsx)(o.A,{primaryColor:i.primaryColor,customLogo:i.customLogo,onSuccess:()=>{let e=sessionStorage.getItem("redirectAfterLogin")||"/";c.push(e),sessionStorage.removeItem("redirectAfterLogin")}}):(0,d.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."})}},2130:e=>{"use strict";e.exports=JSON.parse('{"dashboard":"儀表板","welcome":"歡迎, {{name}}!","logout":"登出","login":"登入","signup":"註冊","chat_to_agentic":"AI 測試助理","usage":"用量","loading":"載入中...","logging_out":"正在登出...","please_wait":"請稍候...","loading_auth":"正在載入驗證...","access_denied":"拒絕存取","auth_required":"需要驗證","please_login":"請登入以存取此頁面","username":"使用者名稱","password":"密碼","forgot_password":"忘記密碼?","remember_me":"記住我","submit":"送出","auth_error":"驗證錯誤","invalid_credentials":"使用者名稱或密碼錯誤","defaultValue":"預設值","settings":"設定","account":"帳號","logout_confirmation":"確定要登出嗎?","yes":"是","no":"否","back_to_login":"返回登入","page_not_found":"找不到頁面","go_to_home":"回到首頁","nav":{"dashboard":"儀表板","chat":"聊天助理","usage":"用量","settings":"設定","account":"帳號","logout":"登出"},"dashboard_sections":{"test_assistant":{"title":"Agentic 測試","description":"存取 AI 驅動的測試助理，協助您的 OBM 測試需求。"},"usage":{"title":"用量統計","description":"檢視您的 API 用量、點數與費用管理資訊。"},"settings":{"title":"設定","description":"設定您的應用程式、外觀與 API 連線。"},"account":{"title":"帳號","description":"管理您的帳號設定與偏好。"}},"email":"電子郵件","signup_error":"請輸入電子郵件和密碼","login_error":"電子郵件或密碼錯誤","all_rights_reserved":"版權所有。","user_admin":"管理頁面"}')},2768:()=>{},4560:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,O:()=>l});var s=r(2015),a=r(4722),n=r(8732);let o=(0,s.createContext)({user:null,isAuthenticated:!1,loading:!1,login:async()=>{},logout:()=>{}}),i=()=>(0,s.useContext)(o),l=({children:e})=>{let{data:t,status:r}=(0,a.useSession)(),s=t?.user?{id:t.user.id||"no-id",name:t.user.name||"",email:t.user.email||"",role:t.user.role||"user"}:null;return(0,n.jsx)(o.Provider,{value:{user:s,isAuthenticated:!!s,loading:"loading"===r,login:async()=>{throw Error("Use NextAuth only")},logout:()=>{}},children:e})}},5240:(e,t,r)=>{"use strict";r.a(e,async(e,t)=>{try{var s=r(3977),a=r(7843),n=r(7287),o=r(2130),i=e([s,a]);[s,a]=i.then?(await i)():i,s.default.isInitialized||s.default.use(a.initReactI18next).init({resources:{en:{translation:n},zh:{translation:o}},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1}}),t()}catch(e){t(e)}})},5847:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{A:()=>g});var a=r(2015),n=r(9918),o=r.n(n),i=r(7843),l=r(4233),c=r(4722),u=r(8732),d=e([i]);i=(d.then?(await d)():d)[0];let g=()=>{let{t:e,i18n:t}=(0,i.useTranslation)(),{data:r}=(0,c.useSession)();(0,l.useRouter)();let{0:s,1:n}=(0,a.useState)(!1),d=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(s)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){d.current&&!d.current.contains(e.target)&&n(!1)}},[s]),(0,u.jsx)("header",{className:"w-full bg-gradient-to-r from-blue-400 via-blue-300 to-cyan-200 shadow-md py-4 px-0",children:(0,u.jsxs)("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[(0,u.jsx)("div",{className:"flex items-center gap-2",children:(0,u.jsxs)(o(),{href:"/",className:"text-2xl font-extrabold text-blue-900 tracking-wide drop-shadow",children:["TPV ",(0,u.jsx)("span",{className:"text-blue-900",children:"OBM測試助理"})]})}),(0,u.jsxs)("nav",{className:"flex gap-6",children:[(0,u.jsx)(o(),{href:"/dashboard",className:"text-blue-900 font-medium hover:text-cyan-700 transition-colors duration-200",children:e("dashboard")}),(0,u.jsx)(o(),{href:"/test-agentic",className:"text-blue-900 font-medium hover:text-cyan-700 transition-colors duration-200",children:e("chat_to_agentic")}),r?.user?(0,u.jsxs)("div",{className:"relative inline-block",ref:d,children:[(0,u.jsxs)("button",{className:"text-blue-900 font-medium hover:text-cyan-700 transition-colors duration-200 flex items-center gap-1",onClick:()=>n(e=>!e),"aria-haspopup":"true","aria-expanded":s,children:[r.user.name||r.user.email||"User",(0,u.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),s&&(0,u.jsxs)("div",{className:"absolute right-0 z-10 w-48 mt-2 bg-white rounded shadow-lg animate-fade-in",children:[("admin"===r.user.role||"super admin"===r.user.role)&&(0,u.jsx)(o(),{href:"/admin",className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",children:e("user_admin")||"管理頁面"}),(0,u.jsx)(o(),{href:"/usage",className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",children:e("usage")}),(0,u.jsx)("button",{onClick:()=>{(0,c.signOut)({callbackUrl:"/login"})},className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",children:e("logout")})]})]}):(0,u.jsx)(o(),{href:"/login",className:"text-blue-900 font-medium hover:text-cyan-700 transition-colors duration-200",children:e("login")})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("button",{onClick:()=>t.changeLanguage("en"),className:"px-2 py-1 rounded bg-white text-blue-900 border border-blue-300 hover:bg-blue-100 transition font-semibold",children:"EN"}),(0,u.jsx)("button",{onClick:()=>t.changeLanguage("zh"),className:"px-2 py-1 rounded bg-white text-blue-900 border border-blue-300 hover:bg-blue-100 transition font-semibold",children:"中文"})]})]})})};s()}catch(e){s(e)}})},7287:e=>{"use strict";e.exports=JSON.parse('{"dashboard":"Dashboard","welcome":"Welcome, {{name}}!","logout":"Logout","login":"Login","signup":"Signup","chat_to_agentic":"AI Test Assistant","usage":"Usage","loading":"Loading...","logging_out":"Logging out...","please_wait":"Please wait...","loading_auth":"Loading authentication...","access_denied":"Access Denied","auth_required":"Authentication Required","please_login":"Please log in to access this page","username":"Username","password":"Password","forgot_password":"Forgot password?","remember_me":"Remember me","submit":"Submit","auth_error":"Authentication error","invalid_credentials":"Invalid username or password","defaultValue":"Default Value","settings":"Settings","account":"Account","logout_confirmation":"Are you sure you want to log out?","yes":"Yes","no":"No","back_to_login":"Back to login","page_not_found":"Page not found","go_to_home":"Go to home","nav":{"dashboard":"Dashboard","chat":"Chat Assistant","usage":"Usage","settings":"Settings","account":"Account","logout":"Logout"},"dashboard_sections":{"test_assistant":{"title":"Agentic Testing","description":"Access the AI-powered test assistant to help with your OBM testing needs."},"usage":{"title":"Usage Statistics","description":"View your API usage, credits, and cost management information."},"settings":{"title":"Settings","description":"Configure your application settings, appearance, and API connections."},"account":{"title":"Account","description":"Manage your account settings and preferences."}},"email":"Email","signup_error":"Please enter email and password","login_error":"Invalid email or password","all_rights_reserved":"All rights reserved.","user_admin":"Management"}')},7995:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(2015),a=r(4722),n=r(4233),o=r(8732);let i=({onSuccess:e,primaryColor:t="#3B82F6",customLogo:r})=>{let{0:i,1:l}=(0,s.useState)(""),{0:c,1:u}=(0,s.useState)(""),{0:d,1:g}=(0,s.useState)(null),{0:m,1:p}=(0,s.useState)(!1),{0:h,1:f}=(0,s.useState)(!1),{0:b,1:x}=(0,s.useState)(""),{0:y,1:v}=(0,s.useState)(null),{0:j,1:w}=(0,s.useState)(!1),N=(0,n.useRouter)(),_=async t=>{t.preventDefault(),g(null),p(!0);try{let t=await (0,a.signIn)("credentials",{username:i,password:c,redirect:!1});if(t?.ok&&!t?.error){e&&e(),N.push("/");return}g("Invalid username or password")}catch(e){g("Invalid username or password")}finally{p(!1)}},O=async e=>{e.preventDefault(),v(null),w(!0);try{let e=await fetch("/api/user/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b})}),t=await e.json();e.ok?v("密碼已重設並寄送通知信，請檢查信箱 (新密碼: dify12345)"):v(t.error||"重設失敗")}catch(e){v("重設失敗")}finally{w(!1)}};return(0,o.jsx)("div",{className:"flex items-center justify-center bg-gray-100",children:(0,o.jsxs)("div",{className:"p-8 bg-white rounded-lg shadow-md w-full max-w-md",children:[(0,o.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[r&&(0,o.jsx)("img",{src:r,alt:"Logo",className:"h-16 w-auto mb-2"}),(0,o.jsx)("h2",{className:"text-2xl font-bold text-center",children:"TPV OBM測試助理"}),(0,o.jsx)("p",{className:"mt-2 text-center text-gray-600",children:"Login to access your assistant"}),(0,o.jsx)("p",{className:"mt-1 text-center text-gray-500 text-xs",children:"Default: Test User / dify12345"})]}),d&&(0,o.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:d}),(0,o.jsxs)("form",{onSubmit:_,children:[(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,o.jsx)("input",{id:"email",type:"text",value:i,onChange:e=>l(e.target.value),placeholder:"admin",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,o.jsx)("input",{id:"password",type:"password",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,o.jsx)("button",{type:"submit",disabled:m,style:{backgroundColor:t},className:"w-full py-2 px-4 text-white rounded hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2",children:m?"Logging in...":"Login"})]}),(0,o.jsx)("div",{className:"mt-4 text-center",children:(0,o.jsx)("button",{type:"button",className:"text-blue-600 hover:underline text-sm",onClick:()=>f(e=>!e),children:"忘記密碼？"})}),h&&(0,o.jsxs)("form",{className:"mt-4",onSubmit:O,children:[(0,o.jsxs)("div",{className:"mb-2 text-sm",children:["請輸入註冊信箱，系統會將密碼重設為 ",(0,o.jsx)("b",{children:"dify12345"})," 並寄送通知信。"]}),(0,o.jsx)("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded mb-2",placeholder:"Email",value:b,onChange:e=>x(e.target.value),required:!0}),(0,o.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded",disabled:j,children:j?"重設中...":"重設密碼"}),y&&(0,o.jsx)("div",{className:"mt-2 text-center text-sm text-green-700",children:y})]})]})})}},8019:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>b});var a=r(4722),n=r(4233);r(2768);var o=r(5240),i=r(5847),l=r(1409),c=r(4560),u=r(1916),d=r(8732),g=e([o,i,l]);[o,i,l]=g.then?(await g)():g;let h=["session"];function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){var s,a,n;s=e,a=t,n=r[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f=["/","/login","/signup","/forgot-password"],b=function(e){let{Component:t,pageProps:{session:r}}=e,s=function(e,t){if(null==e)return{};var r,s,a=function(e,t){if(null==e)return{};var r,s,a={},n=Object.keys(e);for(s=0;s<n.length;s++)r=n[s],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e.pageProps,h),o=(0,n.useRouter)(),g=f.includes(o.pathname);return(0,d.jsx)(a.SessionProvider,{session:r,children:(0,d.jsx)(c.O,{children:(0,d.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,d.jsx)(i.A,{}),(0,d.jsx)("main",{className:"flex-1 bg-gray-100",children:g?(0,d.jsx)(t,p({},s)):(0,d.jsx)(u.A,{children:(0,d.jsx)(t,p({},s))})}),(0,d.jsx)(l.A,{})]})})})};s()}catch(e){s(e)}})}};