(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{2418:(e,t,s)=>{"use strict";s.d(t,{A:()=>l}),s(4232);var a=s(7328),n=s.n(a),r=s(7876);let l=function(e){var t=e.title,s=e.children;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n(),{children:[(0,r.jsx)("title",{children:t||"TPV OBM測試助理"}),(0,r.jsx)("meta",{name:"description",content:"TPV OBM測試助理"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsx)("div",{className:"flex flex-col bg-gray-100",children:(0,r.jsx)("main",{className:"flex-1 flex flex-col justify-center items-center w-full p-6",children:s})})]})}},8172:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return s(9571)}])},9571:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(3857),n=s(3081),r=s.n(n),l=s(4232),c=s(2418),i=s(1769),d=s(1040),u=s(7876);function o(){var e,t=(0,i.A)(),s=t.user,n=t.loading,o=(0,l.useState)(null),x=o[0],p=o[1],h=(0,l.useState)(!0),m=h[0],f=h[1],v=(0,l.useState)(null),b=v[0],j=v[1],N=(0,l.useState)(!1),g=N[0],w=N[1],y=(0,l.useState)(""),k=y[0],_=y[1],S=(0,l.useState)(""),E=S[0],A=S[1],C=(0,l.useState)(""),F=C[0],O=C[1],P=(0,l.useState)(null),T=P[0],B=P[1],M=(0,l.useState)(null),V=M[0],X=M[1],D=(0,l.useState)(!1),I=D[0],q=D[1];(0,l.useEffect)(function(){!n&&s&&(f(!0),d.A.get("/api/user/".concat(s.id)).then(function(e){return p(e.data)}).catch(function(e){return j(e.message||"Failed to fetch profile")}).finally(function(){return f(!1)}))},[s,n]);var z=(e=(0,a.A)(r().mark(function e(t){var a;return r().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),B(null),X(null),!(!k||!E||!F)){e.next=6;break}return B("請填寫所有欄位"),e.abrupt("return");case 6:if(E===F){e.next=9;break}return B("新密碼與確認密碼不一致"),e.abrupt("return");case 9:if(q(!0),e.prev=10,s){e.next=13;break}throw Error("尚未登入");case 13:return e.next=15,d.A.post("/api/user/verify-password",{userId:s.id,password:k});case 15:if(e.sent.data.valid){e.next=20;break}return B("原密碼錯誤"),q(!1),e.abrupt("return");case 20:return e.next=22,d.A.put("/api/user/".concat(s.id),{password:E});case 22:X("密碼修改成功"),w(!1),_(""),A(""),O(""),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(10),B((null==(a=e.t0.response)||null==(a=a.data)?void 0:a.error)||e.t0.message||"密碼修改失敗");case 32:return e.prev=32,q(!1),e.finish(32);case 35:case"end":return e.stop()}},e,null,[[10,29,32,35]])})),function(t){return e.apply(this,arguments)});return(0,u.jsx)(c.A,{title:"個人資料",children:(0,u.jsx)("div",{className:"w-full max-w-md",children:(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[(0,u.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"個人資料"}),n?(0,u.jsx)("div",{className:"text-center",children:"載入中..."}):s?m?(0,u.jsx)("div",{className:"text-center",children:"載入中..."}):b?(0,u.jsx)("div",{className:"text-red-500 text-center",children:b}):x?(0,u.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,u.jsxs)("div",{className:"bg-blue-50 rounded p-4 shadow",children:[(0,u.jsx)("div",{className:"font-semibold mb-1",children:"姓名"}),(0,u.jsx)("div",{className:"text-gray-700",children:x.name||(0,u.jsx)("span",{className:"italic text-gray-400",children:"未設定"})})]}),(0,u.jsxs)("div",{className:"bg-blue-50 rounded p-4 shadow",children:[(0,u.jsx)("div",{className:"font-semibold mb-1",children:"Email"}),(0,u.jsx)("div",{className:"text-gray-700",children:x.email})]}),(0,u.jsxs)("div",{className:"bg-blue-50 rounded p-4 shadow",children:[(0,u.jsx)("div",{className:"font-semibold mb-1",children:"密碼"}),g?(0,u.jsxs)("form",{className:"flex flex-col gap-2",onSubmit:z,children:[(0,u.jsx)("input",{type:"password",className:"border rounded px-3 py-2",placeholder:"原密碼",value:k,onChange:function(e){return _(e.target.value)},autoFocus:!0}),(0,u.jsx)("input",{type:"password",className:"border rounded px-3 py-2",placeholder:"新密碼",value:E,onChange:function(e){return A(e.target.value)}}),(0,u.jsx)("input",{type:"password",className:"border rounded px-3 py-2",placeholder:"確認新密碼",value:F,onChange:function(e){return O(e.target.value)}}),T&&(0,u.jsx)("div",{className:"text-red-500 text-sm",children:T}),V&&(0,u.jsx)("div",{className:"text-green-600 text-sm",children:V}),(0,u.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,u.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",disabled:I,children:"儲存"}),(0,u.jsx)("button",{type:"button",className:"bg-gray-300 px-4 py-2 rounded",onClick:function(){w(!1),B(null),X(null)},children:"取消"})]})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"text-gray-700 italic text-gray-400",children:"（請點選下方按鈕修改密碼）"}),(0,u.jsx)("button",{className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded",onClick:function(){return w(!0)},children:"修改密碼"})]})]})]}):null:(0,u.jsx)("div",{className:"text-center text-red-500",children:"請先登入"})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[149,636,593,792],()=>t(8172)),_N_E=e.O()}]);