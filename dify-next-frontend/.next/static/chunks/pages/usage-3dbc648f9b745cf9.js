(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{1683:(e,t,r)=>{"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{A:()=>n})},1708:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/usage",function(){return r(9667)}])},2418:(e,t,r)=>{"use strict";r.d(t,{A:()=>c}),r(4232);var n=r(7328),s=r.n(n),a=r(7876);let c=function(e){var t=e.title,r=e.children;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s(),{children:[(0,a.jsx)("title",{children:t||"TPV OBM測試助理"}),(0,a.jsx)("meta",{name:"description",content:"TPV OBM測試助理"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)("div",{className:"flex flex-col bg-gray-100",children:(0,a.jsx)("main",{className:"flex-1 flex flex-col justify-center items-center w-full p-6",children:r})})]})}},7430:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(1683);function s(e,t){if(e){if("string"==typeof e)return(0,n.A)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return(0,n.A)(e,t)}}},9667:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var n=r(2969),s=r(7430);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,s,a,c,i=[],l=!0,o=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);l=!0);}catch(e){o=!0,s=e}finally{try{if(!l&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(o)throw s}}return i}}(e,t)||(0,s.A)(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=r(4232),i=r(2418),l=r(3857),o=r(3081),d=r.n(o),u=r(1040),f=r(1769),x=r(7876);let h=function(e){var t=e.usageData,r=(0,f.A)(),n=r.user,s=r.loading,a=(0,c.useState)(t||[]),i=a[0],o=a[1],h=(0,c.useState)(!t),m=h[0],p=h[1],j=(0,c.useState)(null),g=j[0],b=j[1];return((0,c.useEffect)(function(){if(!t&&!s&&n){var e;(e=(0,l.A)(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.A.get("/api/user-token-stats?userId=".concat(n.id));case 3:o(e.sent.data.dailyUsage.map(function(e,t){return{id:"".concat(n.id,"-").concat(e.date),date:e.date.slice(0,10),usage:e.tokenUsage,cost:e.billing}})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),b(e.t0.message||"Failed to fetch usage data");case 10:return e.prev=10,p(!1),e.finish(10);case 13:case"end":return e.stop()}},e,null,[[0,7,10,13]])})),function(){return e.apply(this,arguments)})()}},[n,t,s]),s)?(0,x.jsx)("div",{children:"載入中..."}):n?m?(0,x.jsx)("div",{children:"Loading..."}):g?(0,x.jsxs)("div",{className:"text-red-500",children:["Error: ",g]}):(0,x.jsxs)("div",{children:[(0,x.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Usage & Cost Table"}),(0,x.jsxs)("table",{className:"min-w-full border text-sm",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{className:"bg-gray-100",children:[(0,x.jsx)("th",{className:"px-4 py-2 border",children:"Date"}),(0,x.jsx)("th",{className:"px-4 py-2 border",children:"Usage (Tokens)"}),(0,x.jsx)("th",{className:"px-4 py-2 border",children:"Cost (USD)"})]})}),(0,x.jsx)("tbody",{children:i.map(function(e,t){return(0,x.jsxs)("tr",{className:"text-center",children:[(0,x.jsx)("td",{className:"border px-4 py-2",children:e.date}),(0,x.jsx)("td",{className:"border px-4 py-2",children:e.usage}),(0,x.jsx)("td",{className:"border px-4 py-2",children:e.cost})]},e.id||"".concat(e.date,"-").concat(t))})})]})]}):(0,x.jsx)("div",{className:"text-red-500",children:"請先登入"})};function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(){var e=(0,f.A)(),t=e.user,r=e.loading,s=a(c.useState([]),2),i=s[0],l=s[1],o=a(c.useState(!0),2),d=o[0],p=o[1],j=a(c.useState(null),2),g=j[0],b=j[1];c.useEffect(function(){!r&&t&&(p(!0),u.A.get("/api/user-token-stats?userId=".concat(t.id)).then(function(e){l(e.data.dailyUsage.map(function(e){return{date:e.date.slice(0,10),usage:e.tokenUsage,cost:e.billing}}))}).catch(function(e){return b(e.message||"Failed to fetch usage data")}).finally(function(){return p(!1)}))},[t,r]);var v=(0,c.useMemo)(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"day";if(!e||0===e.length)return[];var r={};return e.forEach(function(e){var n;r[n="month"===t?e.date.slice(0,7):e.date.slice(0,10)]||(r[n]={usage:0,cost:0}),r[n].usage+=e.usage,r[n].cost+=e.cost}),Object.entries(r).map(function(e){var t=a(e,2);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){(0,n.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({date:t[0]},t[1])})}(i,"month")},[i]),y=new Date().toISOString().slice(0,10),N=new Date().toISOString().slice(0,7),O=i.find(function(e){return e.date===y}),w=v.find(function(e){return e.date===N});return r?(0,x.jsx)("div",{children:"載入中..."}):t?d?(0,x.jsx)("div",{children:"Loading..."}):g?(0,x.jsxs)("div",{className:"text-red-500",children:["Error: ",g]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,x.jsxs)("div",{className:"bg-purple-50 rounded p-6 shadow flex flex-col items-center",children:[(0,x.jsx)("span",{className:"text-3xl mb-2",children:"\uD83D\uDD22"}),(0,x.jsx)("div",{className:"font-semibold mb-1",children:"今日 API 用量"}),(0,x.jsxs)("div",{className:"text-gray-700",children:[O?O.usage:0," tokens",(0,x.jsx)("br",{}),"$",O?O.cost.toFixed(4):"0.0000"]})]}),(0,x.jsxs)("div",{className:"bg-purple-50 rounded p-6 shadow flex flex-col items-center",children:[(0,x.jsx)("span",{className:"text-3xl mb-2",children:"\uD83D\uDCC5"}),(0,x.jsx)("div",{className:"font-semibold mb-1",children:"本月 API 用量"}),(0,x.jsxs)("div",{className:"text-gray-700",children:[w?w.usage:0," tokens",(0,x.jsx)("br",{}),"$",w?w.cost.toFixed(4):"0.0000"]})]})]}),(0,x.jsx)(h,{usageData:i})]}):(0,x.jsx)("div",{className:"text-red-500",children:"請先登入"})}function j(){return(0,x.jsx)(i.A,{title:"用量 / 報表",children:(0,x.jsx)("div",{className:"w-full max-w-2xl mx-auto",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[(0,x.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"用量 / 報表"}),(0,x.jsx)(p,{})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[149,636,593,792],()=>t(1708)),_N_E=e.O()}]);