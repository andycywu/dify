(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[440],{2418:(e,t,s)=>{"use strict";s.d(t,{A:()=>i}),s(4232);var r=s(7328),n=s.n(r),a=s(7876);let i=function(e){var t=e.title,s=e.children;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:t||"TPV OBM測試助理"}),(0,a.jsx)("meta",{name:"description",content:"TPV OBM測試助理"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)("div",{className:"flex flex-col bg-gray-100",children:(0,a.jsx)("main",{className:"flex-1 flex flex-col justify-center items-center w-full p-6",children:s})})]})}},5644:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-agentic",function(){return s(6825)}])},6825:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>_});var r=s(4232),n=s(236),a=s(2969),i=s(3857),o=s(825),c=s.n(o),l=s(3081),u=s.n(l),d=s(7251),x=s(3745),m=s(1040),p=function(){var e,t,s,r,n,a,o;function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://localhost/v1",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"app-PxzkiLjnjcU2w2ARj5qeflQq";(0,d.A)(this,c),this.apiBaseUrl=e,this.apiKey=t}return(0,x.A)(c,[{key:"sendChatMessage",value:(e=(0,i.A)(u().mark(function e(t){var s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(!t.query||!t.inputs)){e.next=3;break}throw Error("Dify API: query 與 inputs 為必要欄位");case 3:return e.next=5,m.A.post("".concat(this.apiBaseUrl,"/chat-messages"),{query:t.query,inputs:t.inputs,conversation_id:t.conversation_id,response_mode:t.response_mode,user:t.user,user_agent:t.user_agent},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)}});case 5:return s=e.sent,e.abrupt("return",s.data);case 9:if(e.prev=9,e.t0=e.catch(0),!e.t0.response){e.next=13;break}throw Error("Dify API error: ".concat(e.t0.response.status," ").concat(e.t0.response.statusText," - ").concat(JSON.stringify(e.t0.response.data)));case 13:throw e.t0;case 14:case"end":return e.stop()}},e,this,[[0,9]])})),function(t){return e.apply(this,arguments)})},{key:"getConversationHistory",value:(t=(0,i.A)(u().mark(function e(t){var s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.A.get("".concat(this.apiBaseUrl,"/messages"),{headers:{Authorization:"Bearer ".concat(this.apiKey)},params:{conversation_id:t.conversation_id,user:t.user_id,first_id:t.first_id,limit:t.limit||20}});case 2:return s=e.sent,e.abrupt("return",s.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getConversations",value:(s=(0,i.A)(u().mark(function e(t){var s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.A.get("".concat(this.apiBaseUrl,"/conversations"),{headers:{Authorization:"Bearer ".concat(this.apiKey)},params:t?{user:t}:void 0});case 2:return s=e.sent,e.abrupt("return",s.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"createConversation",value:(r=(0,i.A)(u().mark(function e(t){var s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.A.post("".concat(this.apiBaseUrl,"/conversations"),{name:t},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)}});case 2:return s=e.sent,e.abrupt("return",s.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getMessageById",value:(n=(0,i.A)(u().mark(function e(t){var s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.A.get("".concat(this.apiBaseUrl,"/chat-messages/").concat(t),{headers:{Authorization:"Bearer ".concat(this.apiKey)}});case 2:return s=e.sent,e.abrupt("return",s.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getMessageThread",value:(a=(0,i.A)(u().mark(function e(t){var s,r,n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=[],r=t;case 2:if(!r){e.next=10;break}return e.next=5,this.getMessageById(r);case 5:n=e.sent,s.unshift(n),r=n.parent_message_id||void 0,e.next=2;break;case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getSuggestedQuestions",value:(o=(0,i.A)(u().mark(function e(t,s){var r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.A.get("".concat(this.apiBaseUrl,"/messages/").concat(t,"/suggested"),{headers:{Authorization:"Bearer ".concat(this.apiKey)},params:{user:s}});case 2:if(!((r=e.sent).data&&"success"===r.data.result&&Array.isArray(r.data.data))){e.next=5;break}return e.abrupt("return",r.data.data);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),c}(),f=s(1769),h=s(4587),v=s.n(h),g=s(7876);let j=function(e){var t=e.resources,s=Array.isArray(t)?t.filter(function(e){return e.dataset_name&&e.document_name}):[],n=(0,r.useState)(!1),a=n[0],i=n[1];return s&&0!==s.length?(0,g.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,g.jsxs)("div",{className:"font-semibold mb-1 cursor-pointer select-none",onClick:function(){return i(function(e){return!e})},children:["引用來源：",(0,g.jsx)("span",{className:"ml-1 text-blue-500 underline",children:a?"收合":"展開"})]}),a&&(0,g.jsx)("ul",{className:"pl-6 list-disc",children:s.map(function(e,t){return(0,g.jsxs)("li",{className:"ml-2 mb-2",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"font-semibold",children:e.dataset_name})," / ",(0,g.jsx)("span",{children:e.document_name})]}),e.content&&(0,g.jsx)("div",{className:"bg-gray-50 border rounded p-2 mt-1 whitespace-pre-wrap text-gray-700 text-xs",children:e.content})]},t)})})]}):null},y=function(e){var t=e.questions,s=e.onSelect;return t&&0!==t.length?(0,g.jsxs)("div",{className:"mt-2",children:[(0,g.jsx)("div",{className:"font-semibold text-xs text-gray-500 mb-1",children:"猜你想問："}),(0,g.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map(function(e,t){return(0,g.jsx)("button",{className:"bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs hover:bg-blue-100 border border-blue-100",onClick:function(){return null==s?void 0:s(e)},type:"button",children:e},t)})})]}):null},b=function(e){var t,s,n=e.messageId,a=e.apiBaseUrl,o=e.apiKey,c=e.userId,l=(0,r.useState)("idle"),d=l[0],x=l[1],m=(0,r.useState)(""),p=m[0],f=m[1],h=(0,r.useState)(""),v=h[0],j=h[1],y=(t=(0,i.A)(u().mark(function e(){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x("submitting"),j(""),e.prev=2,e.next=5,fetch("".concat(a,"/messages/").concat(n,"/feedbacks"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({rating:"like",user:c})});case 5:x("like"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),x("error"),j("送出失敗，請稍後再試");case 12:case"end":return e.stop()}},e,null,[[2,8]])})),function(){return t.apply(this,arguments)}),b=(s=(0,i.A)(u().mark(function e(){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.trim()){e.next=3;break}return j("請填寫意見內容"),e.abrupt("return");case 3:return x("submitting"),j(""),e.prev=5,e.next=8,fetch("".concat(a,"/messages/").concat(n,"/feedbacks"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({rating:"dislike",user:c,content:p})});case 8:x("submitted"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),x("error"),j("送出失敗，請稍後再試");case 15:case"end":return e.stop()}},e,null,[[5,11]])})),function(){return s.apply(this,arguments)});return"like"===d?(0,g.jsx)("div",{className:"text-green-600 text-xs mt-1",children:"感謝您的正面回饋！"}):"submitted"===d?(0,g.jsx)("div",{className:"text-blue-600 text-xs mt-1",children:"感謝您的意見，我們會持續改進！"}):(0,g.jsxs)("div",{className:"flex flex-col gap-1 mt-2",children:["idle"===d&&(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)("button",{className:"text-lg",title:"讚",onClick:y,children:"\uD83D\uDC4D"}),(0,g.jsx)("button",{className:"text-lg",title:"需要改進",onClick:function(){x("dislike"),j("")},children:"\uD83D\uDC4E"})]}),"dislike"===d&&(0,g.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,g.jsx)("textarea",{className:"border rounded p-1 text-sm",rows:2,placeholder:"請填寫需要改進的地方...",value:p,onChange:function(e){return f(e.target.value)},autoFocus:!0}),(0,g.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,g.jsx)("button",{className:"px-2 py-1 bg-blue-600 text-white rounded text-xs",onClick:b,children:"送出"}),(0,g.jsx)("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs",onClick:function(){return x("idle")},children:"取消"})]}),v&&(0,g.jsx)("div",{className:"text-red-500 text-xs mt-1",children:v})]}),"error"===d&&(0,g.jsx)("div",{className:"text-red-500 text-xs mt-1",children:v})]})};function w(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function k(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?w(Object(s),!0).forEach(function(t){(0,a.A)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):w(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let N=function(e){var t,s,a,o,l,d=e.apiKey,x=e.apiBaseUrl,m=e.avatarSrc,h=void 0===m?"/images/assistant-avatar.png":m,w=e.welcomeMessage,N=void 0===w?"Hello! How can I assist you today?":w,A=e.enableVoice,_=void 0!==A&&A,C=e.enableHistory,S=void 0!==C&&C,D=e.primaryColor,B=void 0===D?"#3B82F6":D,O=e.customStyles,H=void 0===O?{}:O,L=e.customLogo,P=(0,r.useState)([]),M=P[0],T=P[1],E=(0,r.useState)(""),q=E[0],z=E[1],I=(0,r.useState)(!1),U=I[0],K=I[1],Y=(0,r.useState)(null),R=Y[0],V=Y[1],F=(0,r.useState)(!1),Q=F[0],J=F[1],W=(0,r.useState)(!1),X=W[0],G=W[1],Z=(0,r.useState)([]),$=Z[0],ee=Z[1],et=(0,r.useState)(!0),es=et[0],er=et[1],en=(0,r.useState)(void 0),ea=en[0],ei=en[1],eo=(0,r.useState)(!1),ec=eo[0],el=eo[1],eu=(0,r.useRef)(null),ed=(0,f.A)(),ex=ed.user,em=ed.isAuthenticated,ep=ed.loading,ef=new p(x,d);(0,r.useEffect)(function(){N&&T([{id:"welcome",content:N,role:"assistant",timestamp:new Date,isLatestAssistant:!1,fromHistory:!1,metadata:void 0}]),em&&S&&eg()},[em,S,N]),(0,r.useEffect)(function(){R&&1===M.length&&"welcome"===M[0].id&&em&&S&&ej(R)},[R,M,em,S]),(0,r.useEffect)(function(){ev()},[M]);var eh=(t=(0,i.A)(u().mark(function e(t){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!es||!(null!=ex&&ex.id)||"welcome"===t)){e.next=3;break}return ei(void 0),e.abrupt("return");case 3:return e.prev=3,e.next=6,ef.getSuggestedQuestions(t,ex.id);case 6:ei(e.sent),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),ei(void 0);case 13:case"end":return e.stop()}},e,null,[[3,10]])})),function(e){return t.apply(this,arguments)});(0,r.useEffect)(function(){if(!es)return void ei(void 0);if(ec||U||!(M.length>1))ei(void 0);else{var e=M[M.length-1];"assistant"===e.role&&e.isLatestAssistant&&!e.fromHistory?eh(e.id):ei(void 0)}},[M,es,null==ex?void 0:ex.id,ec,U]);var ev=function(){var e;null==(e=eu.current)||e.scrollIntoView({behavior:"smooth"})},eg=(s=(0,i.A)(u().mark(function e(){var t;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ex){e.next=3;break}return console.warn("No user found, cannot load conversations"),e.abrupt("return");case 3:return e.prev=3,console.log("Loading conversations for user.id:",ex.id),e.next=7,ef.getConversations(ex.id);case 7:console.log("Dify getConversations result:",t=e.sent),Array.isArray(t)?ee(t):Array.isArray(t.data)?ee(t.data):Array.isArray(t.results)?ee(t.results):ee([]),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.error("Failed to load conversations",e.t0);case 15:case"end":return e.stop()}},e,null,[[3,12]])})),function(){return s.apply(this,arguments)}),ej=(a=(0,i.A)(u().mark(function e(t){var s,r,n,a;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return el(!0),e.prev=1,e.next=4,ef.getConversationHistory({conversation_id:t,user_id:null==ex?void 0:ex.id,limit:50});case 4:s=e.sent,V(t),r=(s.data||[]).flatMap(function(e,t){var s,r,n=function(e){if(null==e)return new Date;if("number"==typeof e){if(e>1e12)return new Date(e);if(e>1e9)return new Date(1e3*e)}if("string"==typeof e){var t=Number(e);if(!isNaN(t)){if(t>1e12)return new Date(t);if(t>1e9)return new Date(1e3*t)}if(!isNaN(Date.parse(e)))return new Date(e)}return new Date}(null!=(s=e.created_at)?s:null==(r=e.metadata)?void 0:r.created_at),a=[];if("string"==typeof e.query&&e.query.trim()&&a.push({id:e.id+"-user",rawId:e.id,content:e.query,role:"user",timestamp:n,metadata:e.metadata,fromHistory:!0,isLatestAssistant:!1}),"string"==typeof e.answer&&e.answer.trim()&&a.push({id:e.id+"-assistant",rawId:e.id,content:e.answer,role:"assistant",timestamp:n,metadata:e.metadata,fromHistory:!0,isLatestAssistant:!1}),0===a.length){var i=e.content||"";a.push({id:e.id||Math.random().toString(),rawId:e.id,content:i,role:e.role||(e.answer?"assistant":"user"),timestamp:n,metadata:e.metadata,fromHistory:!0,isLatestAssistant:!1})}return a}),n=-1,a=r.length-1;case 9:if(!(a>=0)){e.next=16;break}if("assistant"!==r[a].role){e.next=13;break}return n=a,e.abrupt("break",16);case 13:a--,e.next=9;break;case 16:-1!==n&&(r[n].isLatestAssistant=!0),T(r),G(!1),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),console.error("Failed to load conversation history",e.t0);case 24:return e.prev=24,el(!1),e.finish(24);case 27:case"end":return e.stop()}},e,null,[[1,21,24,27]])})),function(e){return a.apply(this,arguments)}),ey=(o=(0,i.A)(u().mark(function e(){var t,s,r,a;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(q.trim()){e.next=2;break}return e.abrupt("return");case 2:return t={id:Math.random().toString(),content:q,role:"user",timestamp:new Date,isLatestAssistant:!1,metadata:void 0,fromHistory:!1},T(function(e){return e.map(function(e){var t,s;return k(k({},e),{},{isLatestAssistant:!1,fromHistory:null!=(t=e.fromHistory)&&t,metadata:null!=(s=e.metadata)?s:void 0})}).concat(t)}),z(""),K(!0),e.prev=6,e.next=9,ef.sendChatMessage({query:q,conversation_id:R||void 0,user:null==ex?void 0:ex.id,response_mode:"blocking",inputs:{}});case 9:r=e.sent,null!=ex&&ex.id&&null!=r&&null!=(s=r.metadata)&&null!=(s=s.usage)&&s.total_tokens&&fetch("/api/usage-log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:ex.id,tokenUsage:r.metadata.usage.total_tokens})}),a={id:r.id,content:r.answer,role:"assistant",timestamp:"number"==typeof r.created_at&&r.created_at>1e9?new Date(1e3*r.created_at):new Date,metadata:r.metadata,isLatestAssistant:!0,fromHistory:!1},T(function(e){return e.map(function(e){var t,s;return k(k({},e),{},{isLatestAssistant:!1,fromHistory:null!=(t=e.fromHistory)&&t,metadata:null!=(s=e.metadata)?s:void 0})}).concat(a)}),R||V(r.conversation_id),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(6),console.error("Error sending message:",e.t0),T(function(e){return[].concat((0,n.A)(e),[{id:Math.random().toString(),content:"Sorry, there was an error processing your request.",role:"assistant",timestamp:new Date,metadata:void 0,isLatestAssistant:!1,fromHistory:!1}])});case 20:return e.prev=20,K(!1),e.finish(20);case 23:case"end":return e.stop()}},e,null,[[6,16,20,23]])})),function(){return o.apply(this,arguments)}),eb=(l=(0,i.A)(u().mark(function e(){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:V(null),T([{id:"welcome",content:N,role:"assistant",timestamp:new Date,isLatestAssistant:!1,fromHistory:!1,metadata:void 0}]);case 2:case"end":return e.stop()}},e)})),function(){return l.apply(this,arguments)});return ep?(0,g.jsx)("div",{className:"flex items-center justify-center h-full",children:"載入中..."}):em?(0,g.jsxs)("div",{style:k(k({},H.chatContainer),{},{backgroundColor:"#ffffff",height:"600px",maxHeight:"80vh",minHeight:"400px"}),className:"jsx-2415519904 flex flex-col rounded-lg shadow-lg overflow-hidden border border-gray-200",children:[(0,g.jsxs)("div",{style:{backgroundColor:B,color:"white"},className:"jsx-2415519904 flex justify-between items-center p-4 border-b",children:[(0,g.jsxs)("div",{className:"jsx-2415519904 flex items-center",children:[L?(0,g.jsx)("div",{className:"jsx-2415519904 w-8 h-8 mr-2",children:(0,g.jsx)(v(),{src:L,alt:"Logo",width:32,height:32,className:"rounded"})}):null,(0,g.jsx)("h2",{className:"jsx-2415519904 text-xl font-semibold",children:"TPV OBM測試助理"})]}),(0,g.jsx)("div",{className:"jsx-2415519904 flex items-center ml-4",children:(0,g.jsxs)("label",{className:"jsx-2415519904 flex items-center cursor-pointer text-xs select-none",children:[(0,g.jsx)("input",{type:"checkbox",checked:es,onChange:function(e){return er(e.target.checked)},className:"jsx-2415519904 form-checkbox h-4 w-4 text-blue-600"}),(0,g.jsx)("span",{className:"jsx-2415519904 ml-2",children:"建議問題"})]})}),S&&em&&(0,g.jsx)("button",{onClick:function(){return G(!X)},style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},className:"jsx-2415519904 p-2 rounded hover:bg-opacity-80 ml-2",children:X?"Hide History":"Show History"})]}),(0,g.jsxs)("div",{className:"jsx-2415519904 flex flex-1 overflow-hidden",children:[X&&S&&em&&(0,g.jsxs)("div",{className:"jsx-2415519904 w-64 border-r border-gray-200 overflow-y-auto p-2 bg-gray-50",children:[(0,g.jsx)("div",{className:"jsx-2415519904 mb-2",children:(0,g.jsx)("button",{style:{backgroundColor:B},onClick:eb,className:"jsx-2415519904 w-full p-2 rounded text-white mb-2",children:"New Conversation"})}),(0,g.jsxs)("div",{className:"jsx-2415519904",children:[(0,g.jsx)("h3",{className:"jsx-2415519904 font-medium text-sm text-gray-500 mb-1",children:"History"}),$.length>0?$.map(function(e){return(0,g.jsxs)("div",{onClick:function(){return ej(e.id)},className:"jsx-2415519904 "+"p-2 rounded cursor-pointer mb-1 hover:bg-gray-200 ".concat(R===e.id?"bg-gray-200":""),children:[(0,g.jsx)("p",{className:"jsx-2415519904 truncate text-sm",children:e.name||"Conversation"}),(0,g.jsx)("p",{className:"jsx-2415519904 text-xs text-gray-500",children:e.created_at?"number"==typeof e.created_at?new Date(e.created_at*(e.created_at>1e12?1:1e3)).toLocaleDateString():new Date(e.created_at).toLocaleDateString():""})]},e.id)}):(0,g.jsx)("p",{className:"jsx-2415519904 text-sm text-gray-500 italic",children:"No conversations yet"})]})]}),(0,g.jsxs)("div",{style:H.messageContainer,className:"jsx-2415519904 flex-1 flex flex-col overflow-hidden",children:[(0,g.jsxs)("div",{className:"jsx-2415519904 flex-1 overflow-y-auto p-4",children:[M.map(function(e,t){var s,r,n="assistant"===e.role;return n&&e.metadata&&(r=(s=e.metadata)&&Array.isArray(s.retriever_resources)?(console.log("Extracted citation:",s.retriever_resources),s.retriever_resources):void console.log("No retriever_resources in metadata",s)),(0,g.jsx)("div",{className:"jsx-2415519904 "+"mb-4 ".concat("user"===e.role?"flex justify-end":"flex justify-start"),children:(0,g.jsxs)("div",{style:"user"===e.role?k(k({},H.userMessage),{},{backgroundColor:"".concat(B,"20")}):H.assistantMessage,className:"jsx-2415519904 "+"max-w-3/4 rounded-lg p-3 ".concat("user"===e.role?"bg-blue-100 text-gray-800":"bg-gray-100 text-gray-800"),children:[n&&(0,g.jsxs)("div",{className:"jsx-2415519904 flex items-start mb-1",children:[(0,g.jsx)("div",{className:"jsx-2415519904 w-6 h-6 mr-2 rounded-full overflow-hidden",children:(0,g.jsx)(v(),{src:h,alt:"Assistant",width:24,height:24})}),(0,g.jsx)("span",{className:"jsx-2415519904 font-bold text-sm",children:"Assistant"})]}),"user"===e.role&&(0,g.jsx)("div",{className:"jsx-2415519904 flex items-center mb-1",children:(0,g.jsx)("span",{className:"jsx-2415519904 font-bold text-xs text-blue-600 mr-2",children:"User Query"})}),(0,g.jsx)("div",{className:"jsx-2415519904 whitespace-pre-wrap",children:e.content||"[EMPTY]"}),n&&(0,g.jsxs)(g.Fragment,{children:[r&&(0,g.jsx)(j,{resources:r}),ex&&(0,g.jsx)("div",{className:"jsx-2415519904 mt-1",children:(0,g.jsx)(b,{messageId:e.rawId||e.id,apiBaseUrl:x,apiKey:d,userId:ex.id})}),es&&ea&&e.isLatestAssistant&&(0,g.jsx)(y,{questions:ea,onSelect:z})]}),(0,g.jsx)("div",{className:"jsx-2415519904 text-xs text-gray-500 mt-1 text-right",children:e.timestamp.toLocaleString()})]})},e.id)}),U&&(0,g.jsx)("div",{className:"jsx-2415519904 flex justify-start mb-4",children:(0,g.jsx)("div",{className:"jsx-2415519904 bg-gray-100 rounded-lg p-3 flex items-center",children:(0,g.jsxs)("div",{className:"jsx-2415519904 typing-indicator",children:[(0,g.jsx)("span",{className:"jsx-2415519904"}),(0,g.jsx)("span",{className:"jsx-2415519904"}),(0,g.jsx)("span",{className:"jsx-2415519904"})]})})}),(0,g.jsx)("div",{ref:eu,className:"jsx-2415519904"})]}),(0,g.jsx)("div",{style:H.inputArea,className:"jsx-2415519904 border-t border-gray-200 p-4 bg-white",children:(0,g.jsxs)("div",{className:"jsx-2415519904 flex items-end",children:[(0,g.jsx)("textarea",{rows:2,value:q,onChange:function(e){return z(e.target.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ey())},placeholder:"Type your message...",style:{minHeight:"60px"},className:"jsx-2415519904 w-full resize-none border border-gray-300 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,g.jsxs)("div",{className:"jsx-2415519904 flex ml-2",children:[_&&(0,g.jsx)("button",{onClick:function(){if(_)if("webkitSpeechRecognition"in window){var e=new window.webkitSpeechRecognition;e.lang="zh-TW",e.continuous=!1,e.interimResults=!1,e.onstart=function(){J(!0)},e.onresult=function(e){var t=e.results[0][0].transcript;z(function(e){return e+" "+t})},e.onend=function(){J(!1)},e.start()}else if("SpeechRecognition"in window){var t=new window.SpeechRecognition;t.lang="zh-TW",t.continuous=!1,t.interimResults=!1,t.onstart=function(){J(!0)},t.onresult=function(e){var t=e.results[0][0].transcript;z(function(e){return e+" "+t})},t.onend=function(){J(!1)},t.start()}else alert("Speech recognition is not supported in this browser.")},title:"Voice input",className:"jsx-2415519904 "+"p-2 rounded-full mr-2 ".concat(Q?"bg-red-500":"bg-gray-200 hover:bg-gray-300"),children:(0,g.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"jsx-2415519904 h-5 w-5",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z",className:"jsx-2415519904"})})}),(0,g.jsx)("button",{style:{backgroundColor:B},onClick:ey,disabled:U||!q.trim(),className:"jsx-2415519904 p-2 rounded-full text-white",children:(0,g.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{transform:"rotate(90deg)"},className:"jsx-2415519904 h-5 w-5",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8",className:"jsx-2415519904"})})})]})]})})]})]}),(0,g.jsx)(c(),{id:"2415519904",children:[".typing-indicator.jsx-2415519904{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}",".typing-indicator.jsx-2415519904 span.jsx-2415519904{height:8px;width:8px;margin:0 2px;background-color:#8B8B8B;border-radius:50%;display:inline-block;-webkit-animation:bounce-jsx-2415519904 1.5s infinite ease-in-out;animation:bounce-jsx-2415519904 1.5s infinite ease-in-out;}",".typing-indicator.jsx-2415519904 span.jsx-2415519904:nth-child(2){-webkit-animation-delay:0.2s;animation-delay:0.2s;}",".typing-indicator.jsx-2415519904 span.jsx-2415519904:nth-child(3){-webkit-animation-delay:0.4s;animation-delay:0.4s;}","@-webkit-keyframes bounce-jsx-2415519904{0%,60%,100%{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}30%{-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px);transform:translateY(-5px);}}","@keyframes bounce-jsx-2415519904{0%,60%,100%{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}30%{-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px);transform:translateY(-5px);}}"]})]}):(0,g.jsx)("div",{className:"flex items-center justify-center h-full",children:"請先登入以使用智能機器人對話匡"})};var A=s(2418);function _(){var e=(0,f.A)(),t=(e.user,e.isAuthenticated);return e.loading?(0,g.jsx)(A.A,{title:"對話機器人",children:(0,g.jsx)("div",{className:"flex items-center justify-center h-full",children:"載入中..."})}):t?(0,g.jsx)(A.A,{title:"對話機器人",children:(0,g.jsx)("div",{className:"flex items-center justify-center bg-gray-50",children:(0,g.jsx)("div",{className:"w-full max-w-2xl",children:(0,g.jsx)(N,{apiKey:"app-PxzkiLjnjcU2w2ARj5qeflQq",apiBaseUrl:"http://localhost/v1",avatarSrc:"/images/assistant-avatar.png",welcomeMessage:"您好！這裡是智能機器人，請問有什麼可以幫您？",enableVoice:!0,enableHistory:!0,primaryColor:"#3B82F6"})})})}):(0,g.jsx)(A.A,{title:"對話機器人",children:(0,g.jsx)("div",{className:"flex items-center justify-center h-full",children:"請先登入以使用智能機器人對話匡"})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[149,472,636,593,792],()=>t(5644)),_N_E=e.O()}]);